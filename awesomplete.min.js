// Awesomplete - Lea Verou - MIT license
(function(){function h(a){a=Array.isArray(a)?{label:a[0],value:a[1]}:"object"===typeof a&&"label"in a&&"value"in a?a:{label:a,value:a};this.label=a.label||a.value;this.value=a.value}function n(a,b,e){for(var f in b){var g=b[f],c=a.input.getAttribute("data-"+f.toLowerCase());a[f]="number"===typeof g?parseInt(c):!1===g?null!==c:g instanceof Function?null:c;a[f]||0===a[f]||(a[f]=f in e?e[f]:g)}}function c(a,b){return"string"===typeof a?(b||document).querySelector(a):a||null}function k(a,b){return l.call((b||
document).querySelectorAll(a))}function m(){k("input.awesomplete").forEach(function(a){new d(a)})}var d=function(a,b){var e=this;this.input=c(a);this.input.setAttribute("autocomplete","off");this.input.setAttribute("aria-autocomplete","list");b=b||{};n(this,{minChars:2,maxItems:10,autoFirst:!1,data:d.DATA,filter:d.FILTER_CONTAINS,sort:d.SORT_BYLENGTH,item:d.ITEM,replace:d.REPLACE},b);this.index=-1;this.container=c.create("div",{className:"awesomplete",around:a});this.ul=c.create("ul",{hidden:"hidden",
inside:this.container});this.status=c.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-relevant":"additions",inside:this.container});c.bind(this.input,{input:this.evaluate.bind(this),blur:this.close.bind(this),keydown:function(a){var b=a.keyCode;if(e.opened)if(13===b&&e.selected)a.preventDefault(),e.select();else if(27===b)e.close();else if(38===b||40===b)a.preventDefault(),e[38===b?"previous":"next"]()}});c.bind(this.input.form,{submit:this.close.bind(this)});
c.bind(this.ul,{mousedown:function(a){var b=a.target;if(b!==this){for(;b&&!/li/i.test(b.nodeName);)b=b.parentNode;b&&0===a.button&&(a.preventDefault(),e.select(b,a.target))}}});this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||b.list||[];d.all.push(this)};d.prototype={set list(a){if(Array.isArray(a))this._list=a;else if("string"===typeof a&&-1<a.indexOf(","))this._list=a.split(/\s*,\s*/);
else if((a=c(a))&&a.children){var b=[];l.apply(a.children).forEach(function(a){if(!a.disabled){var f=a.textContent.trim(),c=a.value||f;a=a.label||f;""!==c&&b.push({label:a,value:c})}});this._list=b}document.activeElement===this.input&&this.evaluate()},get selected(){return-1<this.index},get opened(){return!this.ul.hasAttribute("hidden")},close:function(){this.ul.setAttribute("hidden","");this.index=-1;c.fire(this.input,"awesomplete-close")},open:function(){this.ul.removeAttribute("hidden");this.autoFirst&&
-1===this.index&&this["goto"](0);c.fire(this.input,"awesomplete-open")},next:function(){this["goto"](this.index<this.ul.children.length-1?this.index+1:-1)},previous:function(){var a=this.ul.children.length;this["goto"](this.selected?this.index-1:a-1)},"goto":function(a){var b=this.ul.children;this.selected&&b[this.index].setAttribute("aria-selected","false");this.index=a;-1<a&&0<b.length&&(b[a].setAttribute("aria-selected","true"),this.status.textContent=b[a].textContent,c.fire(this.input,"awesomplete-highlight",
{text:this.suggestions[this.index]}))},select:function(a,b){a?this.index=c.siblingIndex(a):a=this.ul.children[this.index];if(a){var e=this.suggestions[this.index];c.fire(this.input,"awesomplete-select",{text:e,origin:b||a})&&(this.replace(e),this.close(),c.fire(this.input,"awesomplete-selectcomplete",{text:e}))}},evaluate:function(a){a=a||{autoOpen:!0};var b=this,e=this.input.value;this.index=-1;this.ul.innerHTML="";var c=this._list.map(function(a){return new h(b.data(a,e))}).filter(function(a){return b.filter(a,
e)});this.sort&&(c=c.sort(this.sort));0<this.maxItems&&(c=c.slice(0,this.maxItems));this.suggestions=c;this.suggestions.forEach(function(a){b.ul.appendChild(b.item(a,e))});e.length>=this.minChars&&0<this._list.length?0===this.ul.children.length?this.close():a.autoOpen&&this.open():this.close()}};d.all=[];d.FILTER_CONTAINS=function(a,b){return RegExp(c.regExpEscape(b.trim()),"i").test(a)};d.FILTER_STARTSWITH=function(a,b){return RegExp("^"+c.regExpEscape(b.trim()),"i").test(a)};d.SORT_BYLENGTH=function(a,
b){return a.length!==b.length?a.length-b.length:a<b?-1:1};d.ITEM=function(a,b){var e=""===b?a:a.replace(RegExp(c.regExpEscape(b.trim()),"gi"),"<mark>$&</mark>");return c.create("li",{innerHTML:e,"aria-selected":"false"})};d.REPLACE=function(a){this.input.value=a.value};d.DATA=function(a){return a};Object.defineProperty(h.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}});h.prototype.toString=h.prototype.valueOf=function(){return""+this.label};var l=Array.prototype.slice;
c.create=function(a,b){var e=document.createElement(a),f;for(f in b){var d=b[f];"inside"===f?c(d).appendChild(e):"around"===f?(d=c(d),d.parentNode.insertBefore(e,d),e.appendChild(d)):f in e?e[f]=d:e.setAttribute(f,d)}return e};c.bind=function(a,b){if(a)for(var c in b){var d=b[c];c.split(/\s+/).forEach(function(b){a.addEventListener(b,d)})}};c.fire=function(a,b,c){var d=document.createEvent("HTMLEvents");d.initEvent(b,!0,!0);for(var g in c)d[g]=c[g];return a.dispatchEvent(d)};c.regExpEscape=function(a){return a.replace(/[-\\^$*+?.()|[\]{}]/g,
"\\$&")};c.siblingIndex=function(a){for(var b=0;a=a.previousElementSibling;b++);return b};"undefined"!==typeof Document&&("loading"!==document.readyState?m():document.addEventListener("DOMContentLoaded",m));d.$=c;d.$$=k;"undefined"!==typeof self&&(self.Awesomplete=d);"object"===typeof module&&module.exports&&(module.exports=d);return d})();